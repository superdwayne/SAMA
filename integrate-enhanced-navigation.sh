#!/bin/bash\n\n# Dynamic Repositioning Integration Script\n# This script helps integrate the enhanced navigation system\n\necho \"🚀 Integrating Enhanced Dynamic Repositioning System\"\necho \"================================================\"\n\n# Check if we're in the right directory\nif [ ! -f \"package.json\" ]; then\n    echo \"❌ Error: Please run this script from your project root directory\"\n    exit 1\nfi\n\n# Backup existing navigation files\necho \"📦 Creating backup of existing navigation files...\"\nmkdir -p backups/$(date +%Y%m%d_%H%M%S)\ncp src/utils/navigation.js backups/$(date +%Y%m%d_%H%M%S)/navigation.js.backup 2>/dev/null || echo \"ℹ️  No existing navigation.js to backup\"\ncp src/components/EnhancedNavigation.jsx backups/$(date +%Y%m%d_%H%M%S)/EnhancedNavigation.jsx.backup 2>/dev/null || echo \"ℹ️  No existing EnhancedNavigation.jsx to backup\"\n\necho \"✅ Backup completed\"\n\n# Check if new files exist\necho \"🔍 Checking new enhanced navigation files...\"\n\nif [ ! -f \"src/utils/enhancedNavigation.js\" ]; then\n    echo \"❌ Error: src/utils/enhancedNavigation.js not found\"\n    echo \"   Please ensure you've added the enhanced navigation service file\"\n    exit 1\nfi\n\nif [ ! -f \"src/components/SmartNavigation.jsx\" ]; then\n    echo \"❌ Error: src/components/SmartNavigation.jsx not found\"\n    echo \"   Please ensure you've added the smart navigation component file\"\n    exit 1\nfi\n\necho \"✅ Enhanced navigation files found\"\n\n# Find and update import statements\necho \"🔧 Searching for files that need import updates...\"\n\n# Search for files importing the old navigation service\nfind src -name \"*.jsx\" -o -name \"*.js\" | xargs grep -l \"from.*navigation\" | while read file; do\n    echo \"  📝 Found navigation import in: $file\"\ndone\n\n# Search for files importing EnhancedNavigation component\nfind src -name \"*.jsx\" -o -name \"*.js\" | xargs grep -l \"EnhancedNavigation\" | while read file; do\n    echo \"  📝 Found EnhancedNavigation import in: $file\"\ndone\n\necho \"\"\necho \"🎯 Integration Steps:\"\necho \"1. Update imports in your main map component:\"\necho \"   OLD: import { navigationService } from '../utils/navigation';\"\necho \"   NEW: import { enhancedNavigationService } from '../utils/enhancedNavigation';\"\necho \"\"\necho \"2. Replace EnhancedNavigation component:\"\necho \"   OLD: import EnhancedNavigation from './components/EnhancedNavigation';\"\necho \"   NEW: import SmartNavigation from './components/SmartNavigation';\"\necho \"\"\necho \"3. Update component usage:\"\necho \"   OLD: <EnhancedNavigation ... />\"\necho \"   NEW: <SmartNavigation ... />\"\necho \"\"\necho \"4. Update service references:\"\necho \"   OLD: navigationService.startNavigation(...)\"\necho \"   NEW: enhancedNavigationService.startNavigation(...)\"\necho \"\"\n\n# Check package.json for potential dependency issues\necho \"📋 Checking package.json for dependencies...\"\nif grep -q \"react\" package.json; then\n    echo \"✅ React found in dependencies\"\nelse\n    echo \"⚠️  Warning: React not found in package.json\"\nfi\n\n# Create a test script\necho \"🧪 Creating test script...\"\ncat > test-enhanced-navigation.js << 'EOF'\n// Test script for enhanced navigation\n// Run with: node test-enhanced-navigation.js\n\nconsole.log('🧪 Testing Enhanced Navigation Integration');\nconsole.log('==========================================');\n\ntry {\n    // Test if enhanced navigation service can be imported\n    const { enhancedNavigationService } = require('./src/utils/enhancedNavigation.js');\n    console.log('✅ Enhanced navigation service imported successfully');\n    \n    // Test service configuration\n    console.log('📊 Configuration:');\n    console.log(`   Off-route threshold: ${enhancedNavigationService.offRouteThreshold}m`);\n    console.log(`   Wrong turn threshold: ${enhancedNavigationService.wrongTurnThreshold}°`);\n    console.log(`   Recalculation cooldown: ${enhancedNavigationService.recalculationCooldown}ms`);\n    \n} catch (error) {\n    console.log('❌ Error importing enhanced navigation service:');\n    console.log('   ', error.message);\n    console.log('   Make sure the file path is correct and the service is properly exported');\n}\n\nconsole.log('\\n🎯 Next steps:');\nconsole.log('1. Update your component imports');\nconsole.log('2. Test navigation with a sample route');\nconsole.log('3. Monitor console for navigation quality feedback');\nconsole.log('4. Adjust thresholds if needed based on testing');\nEOF\n\necho \"✅ Test script created: test-enhanced-navigation.js\"\necho \"\"\necho \"🚀 Quick Test:\"\necho \"   Run: node test-enhanced-navigation.js\"\necho \"\"\necho \"📚 Documentation:\"\necho \"   See: DYNAMIC_REPOSITIONING_GUIDE.md for detailed integration steps\"\necho \"\"\necho \"🎉 Enhanced dynamic repositioning system is ready for integration!\"\necho \"   Features include:\"\necho \"   • Advanced wrong turn detection (30m distance, 45° heading)\"\necho \"   • Multiple recalculation strategies with fallbacks\"\necho \"   • Real-time navigation quality indicators\"\necho \"   • Spatial indexing for better performance\"\necho \"   • Enhanced UI with progress tracking\"\necho \"\"\necho \"⚡ Start by updating your imports and testing with a simple route.\"\necho \"   The system will provide console feedback to help you monitor performance.\""